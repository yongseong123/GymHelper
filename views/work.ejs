<!DOCTYPE html>
<html lang="ko" data-theme="gym-light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymHelper - Work</title>
    <%- include("partials/themeHeadScript") %>
    <link rel="stylesheet" href="/stylesheets/app.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/locales/ko.js"></script>
</head>
<body class="app-shell-bg">
    <div class="drawer min-h-screen" data-app-shell>
        <input id="app-shell-drawer-work" type="checkbox" class="drawer-toggle">

        <div class="drawer-content flex min-h-screen flex-col">
            <header class="app-topbar sticky top-0 z-40 border-b border-base-300/80 bg-base-100/80 backdrop-blur-xl">
                <div class="mx-auto flex w-full max-w-[1480px] items-center gap-2 px-3 py-2.5 sm:px-4 lg:px-6">
                    <div class="flex items-center gap-2">
                        <label for="app-shell-drawer-work" class="btn btn-square btn-ghost btn-sm lg:hidden" aria-label="메뉴 열기">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16" />
                            </svg>
                        </label>

                        <a href="/work" class="inline-flex items-center gap-2 rounded-full px-2 py-1 text-base font-semibold tracking-tight sm:text-lg">
                            <span class="inline-block h-2.5 w-2.5 rounded-full bg-primary"></span>
                            GymHelper
                        </a>
                    </div>

                    <nav class="ml-2 hidden items-center gap-1 lg:flex" aria-label="주요 메뉴">
                        <a href="/work" class="top-nav-link active" aria-current="page">대시보드</a>
                        <a href="/community" class="top-nav-link">커뮤니티</a>
                        <a href="/accountSettings" class="top-nav-link">계정 설정</a>
                    </nav>

                    <div class="ml-auto flex items-center gap-2">
                        <div class="hidden items-center gap-2 rounded-full border border-base-300 bg-base-100/80 px-3 py-1 text-sm md:flex">
                            <span class="text-base-content/65">회원</span>
                            <span class="font-semibold" data-user-name>사용자</span>
                        </div>

                        <button type="button" class="btn btn-sm btn-ghost border border-base-300" data-theme-toggle>
                            <span class="hidden sm:inline">테마</span>
                            <span data-theme-label class="badge badge-ghost badge-sm">다크</span>
                        </button>

                        <button id="logoutBtn" class="btn btn-error btn-sm">로그아웃</button>
                    </div>
                </div>
            </header>

            <main class="mx-auto flex w-full max-w-[1480px] flex-1 flex-col gap-5 px-4 py-5 sm:px-5 lg:px-6 lg:py-6">
                <section class="surface-card overflow-hidden">
                    <div class="card-body gap-4 p-5 sm:p-6">
                        <div class="flex flex-wrap items-center justify-between gap-3">
                            <div class="space-y-2">
                                <p class="text-xs font-semibold uppercase tracking-[0.2em] text-primary/85">Workout Dashboard</p>
                                <h1 class="hero-title text-2xl sm:text-3xl">오늘 루틴과 월간 흐름을 한 화면에서 관리하세요</h1>
                                <p class="max-w-2xl text-sm text-base-content/70 sm:text-[0.95rem]">운동 기록, 부위별 통계, 캘린더를 연결해 진행 상황을 빠르게 확인할 수 있습니다.</p>
                            </div>

                            <div class="flex w-full flex-wrap gap-2 sm:w-auto">
                                <button id="addWorkoutBtn" class="btn btn-primary flex-1 sm:flex-none">운동 등록</button>
                                <button id="myWorkoutsBtn" class="btn btn-outline btn-secondary flex-1 sm:flex-none">운동 모아보기</button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="grid gap-3 sm:grid-cols-2 xl:grid-cols-4">
                    <article class="kpi-stat">
                        <div class="stat-title">계정</div>
                        <div class="stat-value text-[1.35rem]" data-user-name>사용자</div>
                        <div class="stat-desc">현재 로그인 사용자</div>
                    </article>

                    <article class="kpi-stat">
                        <div class="stat-title">월간 집중</div>
                        <div class="stat-value text-[1.35rem] text-primary">Monthly</div>
                        <div class="stat-desc">주요 부위 훈련 추이</div>
                    </article>

                    <article class="kpi-stat">
                        <div class="stat-title">캘린더</div>
                        <div class="stat-value text-[1.35rem] text-secondary">Timeline</div>
                        <div class="stat-desc">날짜별 기록 확인</div>
                    </article>

                    <article class="kpi-stat">
                        <div class="stat-title">분석</div>
                        <div class="stat-value text-[1.35rem] text-accent">Targets</div>
                        <div class="stat-desc">타겟별 빈도 체크</div>
                    </article>
                </section>

                <section class="grid gap-4 2xl:grid-cols-[minmax(0,1.05fr)_minmax(0,0.95fr)]">
                    <div class="grid gap-4">
                        <article class="surface-card">
                            <div class="card-body p-4 sm:p-5">
                                <div class="mb-3 flex flex-wrap items-center justify-between gap-2">
                                    <h2 class="card-title text-lg">월간 운동 통계</h2>
                                    <div class="flex flex-wrap gap-2">
                                        <select id="yearSelector" class="select select-bordered select-sm min-w-[5.5rem]"></select>
                                        <select id="monthSelector" class="select select-bordered select-sm min-w-[5.5rem]">
                                            <option value="1">1월</option>
                                            <option value="2">2월</option>
                                            <option value="3">3월</option>
                                            <option value="4">4월</option>
                                            <option value="5">5월</option>
                                            <option value="6">6월</option>
                                            <option value="7">7월</option>
                                            <option value="8">8월</option>
                                            <option value="9">9월</option>
                                            <option value="10">10월</option>
                                            <option value="11">11월</option>
                                            <option value="12">12월</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="relative h-[310px] rounded-box border border-base-300/85 bg-base-100/75 p-2 sm:p-3">
                                    <canvas id="topGraphCanvas" width="400" height="200" class="!h-full !w-full"></canvas>
                                </div>
                            </div>
                        </article>

                        <article class="surface-card">
                            <div class="card-body p-4 sm:p-5">
                                <div class="mb-3 flex flex-wrap items-center justify-between gap-2">
                                    <h2 class="card-title text-lg">부위별 타겟 추이</h2>
                                    <div id="targetSelector" class="flex flex-wrap gap-1.5">
                                        <button id="chestButton" class="btn btn-xs btn-outline">가슴</button>
                                        <button id="backButton" class="btn btn-xs btn-outline">등</button>
                                        <button id="shoulderButton" class="btn btn-xs btn-outline">어깨</button>
                                        <button id="legButton" class="btn btn-xs btn-outline">하체</button>
                                    </div>
                                </div>

                                <div class="relative h-[310px] rounded-box border border-base-300/85 bg-base-100/75 p-2 sm:p-3">
                                    <canvas id="bottomGraphCanvas" width="400" height="200" class="!h-full !w-full"></canvas>
                                </div>
                            </div>
                        </article>
                    </div>

                    <article class="surface-card min-h-[570px]">
                        <div class="card-body p-4 sm:p-5">
                            <div class="mb-2 flex items-center justify-between gap-2">
                                <h2 class="card-title text-lg">운동 캘린더</h2>
                                <span class="badge badge-outline badge-sm">Monthly / Weekly / Daily</span>
                            </div>
                            <div id="calendar" class="min-h-[620px] w-full rounded-box border border-base-300/80 bg-base-100/75 p-2 sm:p-3"></div>
                        </div>
                    </article>
                </section>
            </main>
        </div>

        <div class="drawer-side z-[60] lg:hidden">
            <label for="app-shell-drawer-work" aria-label="메뉴 닫기" class="drawer-overlay"></label>
            <aside class="drawer-panel flex min-h-full w-80 flex-col border-r border-base-300 bg-base-100/95 p-4 backdrop-blur-xl">
                <div class="mb-6 rounded-box border border-base-300/70 bg-base-200/50 p-4">
                    <a href="/work" class="text-lg font-bold tracking-tight text-primary">GymHelper</a>
                    <p class="mt-1 text-xs text-base-content/65">Workout Tracking Dashboard</p>
                </div>

                <ul class="menu gap-1 px-0">
                    <li><a href="/work" class="menu-link active">대시보드</a></li>
                    <li><a href="/community" class="menu-link">커뮤니티</a></li>
                    <li><a href="/accountSettings" class="menu-link">계정 설정</a></li>
                </ul>

                <div class="mt-6 rounded-box border border-base-300/70 bg-base-200/55 p-4 text-sm text-base-content/75">
                    <p class="font-semibold text-base-content">Tip</p>
                    <p class="mt-1 leading-relaxed">부위 버튼과 월 선택을 함께 사용하면 변화 추이를 더 빠르게 확인할 수 있습니다.</p>
                </div>
            </aside>
        </div>
    </div>

    <div id="myWorkoutsModal" class="fixed inset-0 z-50 hidden app-modal" data-modal-overlay="true" aria-hidden="true">
        <div class="app-modal-backdrop" data-modal-backdrop="true"></div>
        <div class="app-modal-shell">
            <div class="app-modal-panel sm:max-w-6xl" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="myWorkoutsModalTitle" aria-describedby="myWorkoutsModalDesc">
                <div class="app-modal-handle"><span></span></div>

                <header class="app-modal-header">
                    <div class="space-y-1">
                        <p class="modal-kicker">Workout Archive</p>
                        <h2 id="myWorkoutsModalTitle" class="text-lg font-bold sm:text-xl">내 운동 모아보기</h2>
                        <p id="myWorkoutsModalDesc" class="text-sm text-base-content/70">날짜별로 운동 기록을 조회하고 수정/삭제할 수 있습니다.</p>
                    </div>
                    <button type="button" class="close app-modal-close btn btn-sm btn-circle btn-ghost" aria-label="Close">×</button>
                </header>

                <div class="app-modal-body space-y-4">
                    <section class="modal-block">
                        <div class="flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between">
                            <label class="form-control w-full sm:max-w-xs">
                                <span class="label-text pb-1 text-sm font-medium">날짜 선택</span>
                                <input type="date" id="filterDate" class="input input-bordered w-full">
                            </label>
                            <button id="filterDateBtn" class="btn btn-primary w-full sm:w-auto">날짜 검색</button>
                        </div>
                    </section>

                    <section class="modal-block p-0">
                        <div class="overflow-x-auto rounded-box">
                            <table id="myWorkoutsTable" class="table table-zebra table-pin-rows min-w-[920px] align-middle modal-table">
                                <thead>
                                    <tr>
                                        <th>번호</th>
                                        <th>운동 이름</th>
                                        <th class="text-right">중량(kg)</th>
                                        <th class="text-right">횟수</th>
                                        <th>운동 부위</th>
                                        <th>운동 타겟</th>
                                        <th>운동 타입</th>
                                        <th>운동 날짜</th>
                                        <th class="text-center">수정</th>
                                        <th class="text-center">삭제</th>
                                    </tr>
                                </thead>
                                <tbody id="myWorkoutsList"></tbody>
                            </table>
                        </div>
                    </section>
                </div>

                <footer class="app-modal-footer">
                    <div class="flex justify-end">
                        <button type="button" class="close btn btn-ghost w-full sm:w-auto">닫기</button>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <div id="workoutModal" class="fixed inset-0 z-50 hidden app-modal" data-modal-overlay="true" aria-hidden="true">
        <div class="app-modal-backdrop" data-modal-backdrop="true"></div>
        <div class="app-modal-shell">
            <div class="app-modal-panel sm:max-w-2xl" data-modal-panel role="dialog" aria-modal="true" aria-labelledby="workoutModalTitle" aria-describedby="workoutModalDesc">
                <div class="app-modal-handle"><span></span></div>

                <header class="app-modal-header">
                    <div class="space-y-1">
                        <p class="modal-kicker">Workout Editor</p>
                        <h2 id="workoutModalTitle" class="text-lg font-bold sm:text-xl">운동 기록 작성</h2>
                        <p id="workoutModalDesc" class="text-sm text-base-content/70">필수 항목을 입력한 뒤 저장하면 대시보드에 반영됩니다.</p>
                    </div>
                    <button type="button" class="close app-modal-close btn btn-sm btn-circle btn-ghost" aria-label="Close">×</button>
                </header>

                <div class="app-modal-body">
                    <form id="workoutForm" class="grid gap-3 sm:grid-cols-2">
                        <label class="form-control w-full sm:col-span-2">
                            <span class="label-text pb-1 text-sm font-medium">운동 이름 <span class="text-error">*</span></span>
                            <input type="text" id="work_name" name="work_name" placeholder="예: 인클라인 벤치프레스" required class="input input-bordered w-full">
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">중량 (kg)</span>
                            <input type="number" id="work_weight" name="work_weight" placeholder="선택 입력" class="input input-bordered w-full">
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">반복 횟수 <span class="text-error">*</span></span>
                            <input type="number" id="work_count" name="work_count" placeholder="예: 10" required class="input input-bordered w-full">
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">운동 부위 <span class="text-error">*</span></span>
                            <select id="work_part" name="work_part" required class="select select-bordered w-full">
                                <option value="">선택해주세요</option>
                                <option value="가슴">가슴</option>
                                <option value="등">등</option>
                                <option value="어깨">어깨</option>
                                <option value="이두">이두</option>
                                <option value="삼두">삼두</option>
                                <option value="하체">하체</option>
                                <option value="복근">복근</option>
                                <option value="유산소">유산소</option>
                            </select>
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">운동 타겟</span>
                            <select id="work_target" name="work_target" class="select select-bordered w-full">
                                <option value="">선택해주세요</option>
                            </select>
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">운동 타입</span>
                            <select id="work_type" name="work_type" class="select select-bordered w-full">
                                <option value="">선택해주세요</option>
                                <option value="프리웨이트">프리웨이트</option>
                                <option value="머신">머신</option>
                            </select>
                        </label>

                        <label class="form-control w-full">
                            <span class="label-text pb-1 text-sm font-medium">운동 날짜 <span class="text-error">*</span></span>
                            <input type="date" id="work_day" name="work_day" required class="input input-bordered w-full">
                        </label>
                    </form>
                </div>

                <footer class="app-modal-footer">
                    <div class="flex flex-col-reverse gap-2 sm:flex-row sm:justify-end">
                        <button type="button" class="close btn btn-ghost w-full sm:w-auto">취소</button>
                        <button type="button" id="submitWorkoutBtn" class="btn btn-primary w-full sm:w-auto">등록</button>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <script src="/javascripts/theme.js"></script>
    <script src="/javascripts/feedback.js"></script>
    <script src="/javascripts/modalManager.js"></script>
    <script src="/javascripts/work.js"></script>
</body>
</html>
